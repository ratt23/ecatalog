{
  "version": 3,
  "sources": ["file:///D:/schedule-project-main/netlify/functions/migrate_categories.js"],
  "sourceRoot": "C:/Users/rattputt/AppData/Local/Temp/tmp-3856-pZzv6v2cBXFO",
  "sourcesContent": ["\r\n// Migration script using Local API (ESM Syntax)\r\nconst API_URL = 'http://127.0.0.1:8889/.netlify/functions/api';\r\nconst ADMIN_PASSWORD = 'admin123';\r\n\r\nconst DEFAULT_CATEGORIES = [\r\n    { id: 'tarif-kamar', label: 'Tarif Kamar' },\r\n    { id: 'fasilitas', label: 'Fasilitas' },\r\n    { id: 'radiology', label: 'Cek Harga Radiologi' },\r\n    { id: 'layanan-unggulan', label: 'Layanan Unggulan' },\r\n    { id: 'contact-person', label: 'Contact Person' }\r\n];\r\n\r\nasync function migrate() {\r\n    try {\r\n        console.log('\uD83D\uDD04 Starting Migration via API...');\r\n\r\n        // 1. Login to get Cookie\r\n        console.log('\uD83D\uDD11 Logging in...');\r\n        const loginRes = await fetch(`${API_URL}/login`, {\r\n            method: 'POST',\r\n            body: JSON.stringify({ password: ADMIN_PASSWORD }),\r\n            headers: { 'Content-Type': 'application/json' }\r\n        });\r\n\r\n        if (!loginRes.ok) throw new Error('Login failed: ' + loginRes.statusText);\r\n\r\n        // Extract cookie\r\n        const cookie = loginRes.headers.get('set-cookie');\r\n        console.log('\u2705 Login successful');\r\n\r\n        // 2. data\r\n        console.log('\uD83D\uDCE5 Fetching current settings...');\r\n        const settingsRes = await fetch(`${API_URL}/settings`, {\r\n            headers: { 'Cookie': cookie }\r\n        });\r\n        const settingsData = await settingsRes.json();\r\n\r\n        // Convert array to object\r\n        const config = {};\r\n        settingsData.forEach(item => {\r\n            config[item.key] = item.value;\r\n        });\r\n\r\n        // Parse existing\r\n        let currentCategories = [];\r\n        try { currentCategories = JSON.parse(config['ecatalog_categories'] || '[]'); } catch (e) { }\r\n\r\n        let currentVisibility = {};\r\n        try { currentVisibility = JSON.parse(config['category_visibility'] || '{}'); } catch (e) { }\r\n\r\n        console.log(`Current: ${currentCategories.length} categories`);\r\n\r\n        // 3. Prepare Updates\r\n        const updates = [];\r\n\r\n        // Categories\r\n        const newCategories = [...currentCategories];\r\n        const existingIds = new Set(newCategories.map(c => c.id));\r\n        let catsChanged = false;\r\n\r\n        DEFAULT_CATEGORIES.forEach(def => {\r\n            if (!existingIds.has(def.id)) {\r\n                newCategories.push(def);\r\n                existingIds.add(def.id);\r\n                catsChanged = true;\r\n                console.log(`+ Adding category: ${def.label}`);\r\n            }\r\n        });\r\n\r\n        if (catsChanged || newCategories.length < DEFAULT_CATEGORIES.length) {\r\n            updates.push({ key: 'ecatalog_categories', value: JSON.stringify(newCategories) });\r\n        }\r\n\r\n        // Visibility\r\n        const newVisibility = { ...currentVisibility };\r\n        let visChanged = false;\r\n\r\n        DEFAULT_CATEGORIES.forEach(def => {\r\n            // Force true if falsy/missing\r\n            if (!newVisibility[def.id]) {\r\n                newVisibility[def.id] = true;\r\n                visChanged = true;\r\n                console.log(`+ Resetting visibility for: ${def.id}`);\r\n            }\r\n        });\r\n\r\n        if (visChanged) {\r\n            updates.push({ key: 'category_visibility', value: JSON.stringify(newVisibility) });\r\n        }\r\n\r\n        // 4. Send Updates\r\n        if (updates.length > 0) {\r\n            console.log(`\uD83D\uDCE4 Sending ${updates.length} updates...`);\r\n            const updateRes = await fetch(`${API_URL}/settings`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Cookie': cookie\r\n                },\r\n                body: JSON.stringify(updates)\r\n            });\r\n\r\n            if (updateRes.ok) {\r\n                console.log('\u2705 Migration Compeleted Successfully!');\r\n            } else {\r\n                console.log('\u274C Update failed with status: ' + updateRes.status);\r\n                const text = await updateRes.text();\r\n                console.log('Response:', text);\r\n            }\r\n        } else {\r\n            console.log('\u2705 No changes needed.');\r\n        }\r\n\r\n    } catch (e) {\r\n        console.error('\u274C Migration Error:', e);\r\n    }\r\n}\r\n\r\nmigrate();\r\n"],
  "mappings": ";AAEA,IAAM,UAAU;AAChB,IAAM,iBAAiB;AAEvB,IAAM,qBAAqB;AAAA,EACvB,EAAE,IAAI,eAAe,OAAO,cAAc;AAAA,EAC1C,EAAE,IAAI,aAAa,OAAO,YAAY;AAAA,EACtC,EAAE,IAAI,aAAa,OAAO,sBAAsB;AAAA,EAChD,EAAE,IAAI,oBAAoB,OAAO,mBAAmB;AAAA,EACpD,EAAE,IAAI,kBAAkB,OAAO,iBAAiB;AACpD;AAEA,eAAe,UAAU;AACrB,MAAI;AACA,YAAQ,IAAI,yCAAkC;AAG9C,YAAQ,IAAI,yBAAkB;AAC9B,UAAM,WAAW,MAAM,MAAM,GAAG,OAAO,UAAU;AAAA,MAC7C,QAAQ;AAAA,MACR,MAAM,KAAK,UAAU,EAAE,UAAU,eAAe,CAAC;AAAA,MACjD,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAClD,CAAC;AAED,QAAI,CAAC,SAAS,GAAI,OAAM,IAAI,MAAM,mBAAmB,SAAS,UAAU;AAGxE,UAAM,SAAS,SAAS,QAAQ,IAAI,YAAY;AAChD,YAAQ,IAAI,yBAAoB;AAGhC,YAAQ,IAAI,wCAAiC;AAC7C,UAAM,cAAc,MAAM,MAAM,GAAG,OAAO,aAAa;AAAA,MACnD,SAAS,EAAE,UAAU,OAAO;AAAA,IAChC,CAAC;AACD,UAAM,eAAe,MAAM,YAAY,KAAK;AAG5C,UAAM,SAAS,CAAC;AAChB,iBAAa,QAAQ,UAAQ;AACzB,aAAO,KAAK,GAAG,IAAI,KAAK;AAAA,IAC5B,CAAC;AAGD,QAAI,oBAAoB,CAAC;AACzB,QAAI;AAAE,0BAAoB,KAAK,MAAM,OAAO,qBAAqB,KAAK,IAAI;AAAA,IAAG,SAAS,GAAG;AAAA,IAAE;AAE3F,QAAI,oBAAoB,CAAC;AACzB,QAAI;AAAE,0BAAoB,KAAK,MAAM,OAAO,qBAAqB,KAAK,IAAI;AAAA,IAAG,SAAS,GAAG;AAAA,IAAE;AAE3F,YAAQ,IAAI,YAAY,kBAAkB,MAAM,aAAa;AAG7D,UAAM,UAAU,CAAC;AAGjB,UAAM,gBAAgB,CAAC,GAAG,iBAAiB;AAC3C,UAAM,cAAc,IAAI,IAAI,cAAc,IAAI,OAAK,EAAE,EAAE,CAAC;AACxD,QAAI,cAAc;AAElB,uBAAmB,QAAQ,SAAO;AAC9B,UAAI,CAAC,YAAY,IAAI,IAAI,EAAE,GAAG;AAC1B,sBAAc,KAAK,GAAG;AACtB,oBAAY,IAAI,IAAI,EAAE;AACtB,sBAAc;AACd,gBAAQ,IAAI,sBAAsB,IAAI,KAAK,EAAE;AAAA,MACjD;AAAA,IACJ,CAAC;AAED,QAAI,eAAe,cAAc,SAAS,mBAAmB,QAAQ;AACjE,cAAQ,KAAK,EAAE,KAAK,uBAAuB,OAAO,KAAK,UAAU,aAAa,EAAE,CAAC;AAAA,IACrF;AAGA,UAAM,gBAAgB,EAAE,GAAG,kBAAkB;AAC7C,QAAI,aAAa;AAEjB,uBAAmB,QAAQ,SAAO;AAE9B,UAAI,CAAC,cAAc,IAAI,EAAE,GAAG;AACxB,sBAAc,IAAI,EAAE,IAAI;AACxB,qBAAa;AACb,gBAAQ,IAAI,+BAA+B,IAAI,EAAE,EAAE;AAAA,MACvD;AAAA,IACJ,CAAC;AAED,QAAI,YAAY;AACZ,cAAQ,KAAK,EAAE,KAAK,uBAAuB,OAAO,KAAK,UAAU,aAAa,EAAE,CAAC;AAAA,IACrF;AAGA,QAAI,QAAQ,SAAS,GAAG;AACpB,cAAQ,IAAI,qBAAc,QAAQ,MAAM,aAAa;AACrD,YAAM,YAAY,MAAM,MAAM,GAAG,OAAO,aAAa;AAAA,QACjD,QAAQ;AAAA,QACR,SAAS;AAAA,UACL,gBAAgB;AAAA,UAChB,UAAU;AAAA,QACd;AAAA,QACA,MAAM,KAAK,UAAU,OAAO;AAAA,MAChC,CAAC;AAED,UAAI,UAAU,IAAI;AACd,gBAAQ,IAAI,2CAAsC;AAAA,MACtD,OAAO;AACH,gBAAQ,IAAI,uCAAkC,UAAU,MAAM;AAC9D,cAAM,OAAO,MAAM,UAAU,KAAK;AAClC,gBAAQ,IAAI,aAAa,IAAI;AAAA,MACjC;AAAA,IACJ,OAAO;AACH,cAAQ,IAAI,2BAAsB;AAAA,IACtC;AAAA,EAEJ,SAAS,GAAG;AACR,YAAQ,MAAM,2BAAsB,CAAC;AAAA,EACzC;AACJ;AAEA,QAAQ;",
  "names": []
}
